name: Update README Daily

on:
  schedule:
    - cron: '0 0 * * *'  # Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª Û°Û°:Û°Û° UTC (ÛŒØ¹Ù†ÛŒ Ø­Ø¯ÙˆØ¯ Û³:Û³Û° ØµØ¨Ø­ Ø¨Ù‡ ÙˆÙ‚Øª Ø§ÛŒØ±Ø§Ù†)
  workflow_dispatch:    # Ø§Ù…Ú©Ø§Ù† Ø±Ø§Ù† Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÛŒ

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Update GitHub Stats & Streak
        uses: anuraghazra/github-readme-stats@master
        with:
          COMMITTER_TOKEN: ${{ secrets.COMMITTER_TOKEN }}

      - name: Update Streak Stats
        uses: nirzak/streak-stats-action@v1
        with:
          username: AmirrrrMH
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Auto Inject Top Languages (including Private)
        run: |
          curl -s https://api.github.com/users/AmirrrrMH/repos?per_page=100 | \
          jq -r '.[].language' | \
          sort | uniq -c | sort -nr | head -8 | \
          awk '{print $2}' | \
          xargs | sed 's/ /, /g' > languages.txt
          
          LANGUAGES=$(cat languages.txt)
          sed -i "s|<!-- LANGUAGES-OVERVIEW:START -->.*<!-- LANGUAGES-OVERVIEW:END -->|<!-- LANGUAGES-OVERVIEW:START -->\nTop Languages: $LANGUAGES\n<!-- LANGUAGES-OVERVIEW:END -->|" README.md
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Commit & Push if changed
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --quiet && echo "No changes" || git commit -m "ðŸ¤– Auto update stats & languages $(date +'%Y-%m-%d')"
          git push
